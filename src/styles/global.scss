@tailwind base;
@tailwind components;
@tailwind utilities;

// 색상 및 기본 테마 변수
:root {
  --primary: #090b10;
  --secondary: #0f111a;
  --orange: #f48a6b;
  --yellow: #fac76a;
  --green: #b8db85;
  --gray-light: #656b84;
  --gray-dark: #1a1b23;
  --text-color: #f2f2f2;
  --theme-bg-color: #050a06;
  --transition-speed: 0.2s;
  --sidebar-width-open: 280px;
  --sidebar-width-closed: 72px;
  --sidebar-icon-width: 60px;
  --box-shadow-light: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
  --box-shadow-medium: rgba(0, 0, 0, 0.12) 0px 4px 12px;
}

// 브레이크포인트 변수
$breakpoint-mobile: 640px;
$breakpoint-tablet: 1024px;

/* 트랜지션 제어 */
.no-transition * {
  transition: none !important;
}

html.loading * {
  transition: none !important;
}

/* 사이드바 닫힘 상태 스타일 */
html.sidebar-closed body .wrapper,
html.sidebar-closed-initial body .wrapper {
  grid-template-columns: var(--sidebar-icon-width) 1fr !important;
}

html.sidebar-closed body main,
html.sidebar-closed-initial body main {
  margin-left: 0 !important;
}

/* 초기 페이지 로드 시 사이드바 완전 제어 */
html.sidebar-closed-initial .sidebar-right {
  display: none !important;
  visibility: hidden !important;
  left: -9999px !important;
  opacity: 0 !important;
}

/* 반응형 레이아웃 - 모바일 뷰 (640px 이하) */
@media screen and (max-width: $breakpoint-mobile) {
  html.sidebar-closed body main,
  html.sidebar-closed-initial body main,
  html.sidebar-open body main {
    margin-left: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
  }
}

/* 반응형 레이아웃 - 태블릿 뷰 (641px - 1024px) */
@media screen and (min-width: ($breakpoint-mobile + 1px)) and (max-width: ($breakpoint-tablet)) {
  html.sidebar-closed body main,
  html.sidebar-closed-initial body main {
    width: 90% !important;
    max-width: 900px !important;
    margin: 60px auto 0 auto !important;
  }

  html.sidebar-open body main {
    width: calc(100% - var(--sidebar-width-open)) !important;
    max-width: calc(100% - var(--sidebar-width-open)) !important;
    margin-right: auto !important;
    margin-left: var(--sidebar-width-open) !important;
  }
}

/* 반응형 레이아웃 - 데스크톱 뷰 (1025px 이상) */
@media screen and (min-width: ($breakpoint-tablet + 1px)) {
  html.sidebar-closed body main,
  html.sidebar-closed-initial body main {
    width: 90% !important;
    max-width: 1200px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    transition: margin-left 0.3s ease;
  }

  html.sidebar-open body main {
    width: calc(100% - var(--sidebar-width-open)) !important;
    max-width: 1200px !important;
    margin-left: var(--sidebar-width-open) !important;
    margin-right: auto !important;
  }
}

/* 페이지 간 트랜지션 - 접근성 관련 */
.astro-route-announcer {
  visibility: hidden;
  position: absolute;
}

/* 사이드바는 트랜지션에서 제외 */
.sidebar-right {
  view-transition-name: none;
}

@layer base {
  html {
    @apply text-base antialiased;
    background-color: var(--primary);

    &.page-transitioning {
      cursor: wait;
    }
  }

  body {
    @apply m-0 p-0 text-left break-words leading-7 font-sans;
    background-color: var(--primary);
    color: var(--text-color);
    overflow-wrap: anywhere;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply m-0 leading-tight;
    color: var(--text-color);
  }

  h1 {
    @apply text-4xl;
  }
  h2 {
    @apply text-3xl;
  }
  h3 {
    @apply text-2xl;
  }
  h4 {
    @apply text-xl;
  }
  h5 {
    @apply text-lg;
  }

  strong,
  b {
    @apply font-bold;
    color: var(--text-color);
  }

  a {
    color: var(--text-color);
    @apply hover:text-accent;
  }

  p {
    @apply m-0 p-0;
    color: var(--text-color);
  }

  .prose p {
    @apply mb-8;
    color: var(--text-color);
  }

  textarea {
    @apply w-full text-base;
    color: var(--text-color);
  }

  input {
    @apply text-base;
    color: var(--text-color);
  }

  table {
    @apply w-full;
    color: var(--text-color);
  }

  img {
    @apply max-w-full h-auto rounded-lg;
  }

  code {
    @apply py-0.5 px-1.5 bg-muted rounded;
  }

  pre {
    @apply p-6 rounded-lg;
  }

  pre > code {
    all: unset;
  }

  blockquote {
    @apply border-l-4 border-accent pl-5 m-0 text-xl;
  }

  hr {
    @apply border-none border-t border-muted;
  }

  // 접근성 클래스
  .sr-only,
  .a11y-hidden {
    overflow: hidden;
    position: absolute;
    width: 1px;
    height: 1px;
    clip: rect(0, 0, 0, 0);
    clip-path: polygon(0 0, 0 0, 0 0);
  }
}

// 다크 테마 변수
@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 224 71.4% 4.1%;
    --card: 0 0% 100%;
    --card-foreground: 224 71.4% 4.1%;
    --popover: 0 0% 100%;
    --popover-foreground: 224 71.4% 4.1%;
    --primary-hsl: 220.9 39.3% 11%;
    --primary-foreground: 210 20% 98%;
    --secondary-hsl: 220 14.3% 95.9%;
    --secondary-foreground: 220.9 39.3% 11%;
    --muted: 220 14.3% 95.9%;
    --muted-foreground: 220 8.9% 46.1%;
    --accent: 220 14.3% 95.9%;
    --accent-foreground: 220.9 39.3% 11%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 20% 98%;
    --border: 220 13% 91%;
    --input: 220 13% 91%;
    --ring: 224 71.4% 4.1%;
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --radius: 0.5rem;
  }

  .dark {
    --background: 224 71.4% 4.1%;
    --foreground: 210 20% 98%;
    --card: 224 71.4% 4.1%;
    --card-foreground: 210 20% 98%;
    --popover: 224 71.4% 4.1%;
    --popover-foreground: 210 20% 98%;
    --primary-hsl: 210 20% 98%;
    --primary-foreground: 220.9 39.3% 11%;
    --secondary-hsl: 215 27.9% 16.9%;
    --secondary-foreground: 210 20% 98%;
    --muted: 215 27.9% 16.9%;
    --muted-foreground: 217.9 10.6% 64.9%;
    --accent: 215 27.9% 16.9%;
    --accent-foreground: 210 20% 98%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 20% 98%;
    --border: 215 27.9% 16.9%;
    --input: 215 27.9% 16.9%;
    --ring: 216 12.2% 83.9%;
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
}

@layer components {
  // 레이아웃 래퍼 컴포넌트
  .wrapper {
    display: flex;
    min-height: 100vh;
    position: relative; // 위치 기준점 추가

    main {
      flex: 1;
      width: calc(100% - var(--sidebar-width-open));
      margin-left: var(--sidebar-width-open);
      margin-right: auto;
      padding: 2rem;
      transition:
        margin-left 0.3s ease,
        width 0.3s ease;
    }
  }

  // 사이드바 오픈, 클로즈 상태에 따른 메인 영역 조정
  html:not(.sidebar-closed):not(.sidebar-closed-initial) .wrapper main {
    margin-left: 0;
    width: calc(100% - var(--sidebar-width-open));
    padding-left: 1.5rem;
  }

  html.sidebar-closed .wrapper main,
  html.sidebar-closed-initial .wrapper main {
    margin-left: var(--sidebar-icon-width);
    width: calc(100% - var(--sidebar-icon-width));
    padding-left: 1.5rem;
  }

  // 사이드바 컴포넌트 스타일
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 50;
    height: 100vh;

    &.scrolled .sidebar-content,
    &.scrolled .sidebar-background {
      box-shadow: var(--box-shadow-medium);
    }

    // 트랜지션을 부드럽게 하기 위한 설정
    .sidebar-content {
      transition:
        transform 0.3s ease-in-out,
        box-shadow 0.3s ease;
    }

    .sidebar-background {
      transition:
        width 0.3s ease-in-out,
        box-shadow 0.3s ease;
    }

    &.closed .sidebar-content {
      transform: translateX(-100%);
    }
  }

  // 모바일 뷰 (640px 이하)
  @media (max-width: $breakpoint-mobile) {
    .wrapper main {
      margin-left: 0 !important;
      width: 100%;
      padding: 1rem;
      padding-top: 80px; // 모바일에서 상단 네비게이션 높이만큼 여백
    }
  }

  .sidebar-open .wrapper {
    grid-template-columns: var(--sidebar-width-open) 1fr;
  }

  .sidebar-open main {
    width: calc(100% - var(--sidebar-width-open)) !important;
    max-width: 900px !important;
    // margin-left: var(--sidebar-width-open) !important;
    // margin-right: auto !important;
    // padding-left: 1.5rem !important;
  }

  /* 태블릿 뷰 (641px - 1024px) */
  @media screen and (min-width: ($breakpoint-mobile + 1px)) and (max-width: ($breakpoint-tablet)) {
    body {
      position: relative;
      background-color: var(--primary);
    }

    .wrapper {
      grid-template-rows: 60px 1fr;
      grid-template-columns: 1fr;
      grid-template-areas:
        'header'
        'main';
      height: 100vh;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: all 0.3s ease;
    }

    main {
      width: calc(100% - var(--sidebar-width-open)) !important;
      height: calc(100vh - 60px);
      max-width: 900px;
      margin: 60px 0 0 var(--sidebar-width-open) !important;
      padding: 40px;
      padding-left: 2rem;
      position: relative;
      z-index: 10;
      transition:
        margin-left 0.3s ease,
        width 0.3s ease;
    }

    /* 사이드바가 열려있을 때 메인 영역에 마진 추가 */
    .sidebar-open main {
      width: calc(100% - var(--sidebar-width-open)) !important;
      max-width: 900px !important;
      margin-left: var(--sidebar-width-open) !important;
      margin-right: auto !important;
    }

    /* 사이드바가 닫혀있을 때 메인 영역 조정 */
    html.sidebar-closed .wrapper main,
    html.sidebar-closed-initial .wrapper main {
      width: calc(100% - var(--sidebar-icon-width)) !important;
      margin-left: var(--sidebar-icon-width) !important;
    }

    .sidebar-open .wrapper {
      grid-template-columns: var(--sidebar-width-open) 1fr;
      width: 100%;
      align-items: flex-start;
    }
  }
}

// 애니메이션 정의
@keyframes fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}

@keyframes slide-up {
  from {
    transform: translateY(20px);
  }
  to {
    transform: translateY(0);
  }
}

@keyframes slide-down {
  from {
    transform: translateY(0);
  }
  to {
    transform: translateY(20px);
  }
}
